---
title: "qgtools"
output: github_document
---

## Overview

**qgtools** is a framework for specifying and fitting mixed and hierarchical models, with a focus on quantitative genetics and complex covariance structures.

The key idea behind qgtools is to **separate model specification from model fitting**, allowing the same model to be estimated using different software backends and estimation paradigms within a unified modeling framework.


## Core ideas

- **Formulas define model structure**  
  Per-trait formulas specify responses, fixed effects, and random effects, but not how covariance is modeled.

- **Variance components define covariance**  
  Variance components describe how random effects induce covariance across individuals and traits, using kernels and optional priors.

- **Kernels are reusable objects**  
  Pedigree, genomic, and other kernels are standalone objects that can be reused across models and fitting tasks.

- **Tasks control estimation**  
  Models are fitted using `gfit()` with `task = "reml"`, `"bayes"`, or `"solve"`, without changing the model specification.

- **Scalable data access**  
  Data are treated as a data source, allowing both in-memory and disk-backed datasets to be used transparently.

**qgtools** handles large-scale data by taking advantage of:  
  
* multi-core processing using [openMP](https://www.openmp.org/)  
* multithreaded matrix operations implemented in BLAS libraries (e.g. [OpenBLAS](https://www.openblas.net/), [ATLAS](https://math-atlas.sourceforge.net/) or [MKL](https://en.wikipedia.org/wiki/Math_Kernel_Library))  
* fast and memory-efficient batch processing of genotype data stored in binary files (e.g. [PLINK](https://www.cog-genomics.org/plink2) bedfiles)  


## Example

```{r, eval = FALSE}

data <- 

PED <- makePEDlist(fnPED = "pedigree.txt")

formulas <- list(
  BW = BW ~ sex + reps + (1 | dam) + (1 | id)
)

vcs <- list(
  dam_env = vc(index = "dam", traits = "BW"),
  animal_genetic = vc(index = "id", traits = "BW", kernel = PED),
  residual = vc(index = "Residual", traits = "BW")
)

fit <- gfit(formulas, data, vcs, task = "reml")
```

