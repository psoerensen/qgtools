% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/model_constructor.R
\name{gfit}
\alias{gfit}
\title{Fit a qgtools model}
\usage{
gfit(
  formulas,
  data,
  vcs,
  task = c("reml", "bayes", "solve"),
  control = list(),
  ...
)
}
\arguments{
\item{formulas}{Named list of model formulas, one per trait.}

\item{data}{Data source containing observations, covariates, and grouping
variables. May be an in-memory data frame or a disk-backed data source
supporting variable-wise and row-wise access.}

\item{vcs}{Named list of variance component objects created with \code{vc()}.}

\item{task}{Character. Estimation task to use. One of \code{"reml"},
\code{"bayes"}, or \code{"solve"}.}

\item{control}{Optional list of task-specific control parameters.}

\item{...}{Additional arguments passed to task-specific fitting routines.}
}
\value{
An object of class \code{"gfit"} containing the fitted model, parameter
estimates, and task-specific output.
}
\description{
Fit a mixed or hierarchical model defined by per-trait formulas and variance
components using a specified estimation task.
}
\details{
Model formulas define which fixed and random effects are included for each
trait using standard Wilkinson syntax. Variance components (\code{vc()} objects)
define how covariance is induced for those random effects via kernels and
optional priors.

The data supplied to \code{gfit()} may be an in-memory object (e.g. a data frame)
or a disk-backed data source. The fitting procedure accesses only the variables
required by the model and does not assume that all data must reside in memory.

The \code{task} argument controls how the model is fitted:
\itemize{
\item \strong{reml}: Restricted maximum likelihood estimation.
\item \strong{bayes}: Bayesian inference using priors specified in variance
components.
\item \strong{solve}: Fixed-parameter solution with known variance components.
}

Model formulas specify which variables and random effects exist, while variance
components specify how covariance is modeled. This separation allows the same
model specification to be reused across different estimation tasks and data
representations.
}
\examples{
## Single-trait and multi-trait animal models using mouse data

## Pedigree kernel
PED <- makePEDlist(fnPED = mouse_pedigree)

## Single-trait animal model (body weight)
formulas_single <- list(
  BW = BW ~ sex + reps + (1 | dam) + (1 | id)
)

vcs_single <- list(

  ## Dam environmental effect
  dam_env = vc(
    variable  = "dam",
    traits = "BW"
  ),

  ## Additive genetic animal effect
  animal_genetic = vc(
    variable  = "id",
    traits = "BW",
    kernel = PED
  ),

  ## Residual variance
  residual = vc(
    variable  = "residual",
    traits = "BW"
  )
)

fit_single <- gfit(
  formulas = formulas_single,
  data     = mouse,
  vcs      = vcs_single,
  task     = "reml"
)


## Multi-trait animal model (growth and body weight)
formulas_multi <- list(
  Gl = Gl ~ sex + reps + (1 | dam) + (1 | id),
  BW = BW ~ sex + reps + (1 | dam) + (1 | id)
)

vcs_multi <- list(

  ## Dam environmental effect (correlated across traits)
  dam_env = vc(
    variable  = "dam",
    traits = c("Gl", "BW")
  ),

  ## Additive genetic animal effect (animal model)
  animal_genetic = vc(
    variable  = "id",
    traits = c("Gl", "BW"),
    kernel = PED
  ),

  ## Residual covariance between traits
  residual = vc(
    variable  = "residual",
    traits = c("Gl", "BW")
  )
)

fit_multi <- gfit(
  formulas = formulas_multi,
  data     = mouse,
  vcs      = vcs_multi,
  task     = "reml"
)

}
